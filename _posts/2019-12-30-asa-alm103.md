---
layout: post
title:  "Build and Release pipelines for an Azure Stream Analytics job - ALM 103 for ASA"
date:   2019-12-30 10:00:00 -0700
categories: ALM Azure ASA DevOps
---

# Build and Release pipelines for an Azure Stream Analytics job - ASA-ALM-103

This article is part of a series on enabling modern ALM practices for an Azure Stream Analytics project:

- Part 0 : [The story of 2 pipelines](https://www.eiden.ca/asa-alm-100/)
- Part 1 : [Developer experience](https://www.eiden.ca/asa-alm-101/)
- Part 2 : [Provisioning scripts](https://www.eiden.ca/asa-alm-102/)
- Part 3 : [Build and release pipelines](https://www.eiden.ca/asa-alm-103/)

## Context

Now that we have a job that can run live, with its data source and sink, we can start thinking [CI/CD](https://en.wikipedia.org/wiki/CI/CD).

**CI for Continuous Integration**, which is the practice of building our application as often as possible, ideally every time there is a code change. The point, when working as a team on a single scope of work, is to be sure that our code base is always in a happy place as we work collaboratively on it. For us, since we're already using **Azure DevOps** for repos, this will be done in [Azure Pipelines](https://docs.microsoft.com/en-us/azure/devops/pipelines/?view=azure-devops), in the **Build** section. Triggering our builds should be the `Git push`s we make to our central repository.

**CD for Continuous Deployment**, which is the practice of deploying our code to the next environment if its build succeeds (this is a bit more complicated than that, but let's go with that). This will again be done in **Azure Pipelines**, but this time in the **Release** section.

![Illustration of our dev pipeline](https://github.com/Fleid/fleid.github.io/blob/master/_posts/201912_asa_alm101/asa_alm103.png?raw=true)

It is to be noted that I'm not an expert of **Azure DevOps**, so any [feedback](https://github.com/Fleid/fleid.github.io/blob/master/_posts/2019-12-30-asa-alm103.md) on how to do things in a more elegant way is appreciated.

## Build pipeline

In Azure DevOps, just under Repos we can find Pipelines. The first thing we'll create is a **new build pipeline**, linked to our Azure Repos repository. Let's go with YAML mode instead of the "classic editor". It may be a bit foreign at first, not having a UI to help, but that means our build definition will be a file that we can host in our repo. This is nice. Let's pick a **Starter Pipeline**, and we should be greated by something looking like that:

![Screenshot of the starter YAML pipeline](https://github.com/Fleid/fleid.github.io/blob/master/_posts/201912_asa_alm101/asa_alm103_build.png?raw=true)

We can save the YAML file back into our repo by clicking **Save** or **Save and run** (no real difference on a starter script). It should then be located in the root folder of the repo. To get it locally we should sync the repo in VSCode. There it can be moved into our `deploy` folder, which should make the build pipeline unhappy (the file can't be found!). It's easy to correct in the settings, under `YAML file path`:

![Screenshot of the starter YAML pipeline](https://github.com/Fleid/fleid.github.io/blob/master/_posts/201912_asa_alm101/asa_alm103_build_unhappy.png?raw=true)

Now let's take some time to think about what steps should go in there.

### Steps

### build.ps1

### YAML

## Release pipeline

### Release steps

### Secrets

### release.ps1

## Next steps

- ~~Part 0~~ : [The story of 2 pipelines](https://www.eiden.ca/asa-alm-100/)
- ~~Part 1~~ : [Developer experience](https://www.eiden.ca/asa-alm-101/)
- ~~Part 2~~ : [Provisioning scripts](https://www.eiden.ca/asa-alm-102/)
- ~~Part 3~~ : [Build and release pipelines](https://www.eiden.ca/asa-alm-103/)
- Part 4 : To be written...
